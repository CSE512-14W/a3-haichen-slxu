<!DOCTYPE html>
<html class="ocks-org do-not-copy"><head class="datamaps-style-block">
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8">
<title>Sankey Diagram</title>
<style> .datamaps-legend dt, .datamaps-legend dd { float: left; margin: 0 3px 0 0;} .datamaps-legend dd {width: 20px; margin-right: 6px; border-radius: 3px;} .datamaps-legend {padding-bottom: 20px; z-index: 1001; position: absolute; left: 4px; font-size: 12px; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;} .datamaps-hoverover {display: none; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; } .hoverinfo {padding: 4px; border-radius: 1px; background-color: #FFF; box-shadow: 1px 1px 5px #CCC; font-size: 12px; border: 1px solid #CCC; } .hoverinfo hr {border:1px dotted #CCC; }</style>
<style>
body {
  background-color:#222;
}

.tour {
  fill-opacity: .95;
}
 
.node rect {
  cursor: move;
  fill-opacity: .9;
  shape-rendering: crispEdges;
}


.eventMy rect {
  cursor: move;
  fill-opacity: .9;
  shape-rendering: crispEdges;
}
 
.node text {
  pointer-events: none;
  text-shadow: 0 1px 0 #fff;
}
 
.eventlink {
  fill: none;
  stroke: #fff;
  stroke-opacity: .2;
}
 
.link:hover {
  stroke-opacity: .5;
}
 
</style>
</head><body style="fill: black;">
Hello
<script src="js/d3.js"></script>
<script src="js/topojson.js"></script>
<script src="js/datamaps.js"></script>
<script src="sankey/sankey.js"></script>
<div id="container" style="position: relative; width: 960px; height: 900px;"></div>
<script>
  var map = new Datamap({
    element: document.getElementById('container'),
    projection: 'mercator',
    fills: {
      defaultFill: '#222'
    },
    geographyConfig: {
      highlightOnHover: false,
      popupOnHover: false
    }
  });


</script>

<script>
  var units = "Widgets";
 
  var margin = {top: 0, right: 0, bottom: 0, left: 0},
    width = 1600 - 1060,
    height = 600;//960 - margin.top - margin.bottom;
 
  var formatNumber = d3.format(",.0f"),    // zero decimal places
    format = function(d) { return formatNumber(d) + " " + units; },
    color = d3.scale.category20();

  var svg = d3.select("svg") 

  d3.json("data1.json", function(error, graph) {

    var tours = graph.tournaments;
    var players = graph.players;
    var links = graph.links;
    var nameToTour = {}
    var nameToPlayer = {}

    tours.forEach(function(tour) {
      tour.cx = tour.mapX;
      tour.cy = tour.mapY;
      tour.r = tour.score / 250 * 3;
      nameToTour[tour.name] = tour;
    });

    players.forEach(function(player) {
      player.score = 0;
      nameToPlayer[player.name] = player;
    });

    links.forEach(function(link) {
      nameToPlayer[link.target].score += link.value;
    });

    players.sort(function(a, b) { return b.score - a.score; });

    players.forEach(function(player, index) {
      player.r = player.score / 10;
      if (index == 0) {
        player.cx = 10 + player.r;
        player.cy = 10 + player.r;
      } else {
        player.cx = players[index-1].cx + players[index-1].r + 10 + player.r;
        player.cy = 10 + player.r;
      }
      //console.log(player.name + ": " + player.cx + ", " + player.cy + ", " + player.r )
    });

    links.forEach(function(link) {
      tour = nameToTour[link.source];
      player = nameToPlayer[link.target];
      link.srcX = tour.cx;
      link.srcY = tour.cy;
      link.dstX = player.cx;
      link.dstY = player.cy;
    });

    // add tournaments on the map
    svg.append('g')
        .selectAll('.tour')
        .data(tours)
      .enter().append('circle')
        .attr('class', 'tour')
        .attr('cx', function(d) { return d.cx; })
        .attr('cy', function(d) { return d.cy; })
        .attr('r', function(d) { return d.r; })
        //.attr('fill', function (d) {
        //  return d.color = color(d.name.replace(/ .*/, "")); })
        .attr('fill', 'steelblue')
        .attr('stroke', 'none');

    // add players
    svg.append('g')
        .selectAll('.player')
        .data(players)
      .enter().append('circle')
        .attr('class', 'player')
        .attr('cx', function(d) { return d.cx; })
        .attr('cy', function(d) { return d.cy; })
        .attr('r', function(d) { return d.r; })
        .attr('fill', function (d) {
          return d.color = color(d.name.replace(/ .*/, "")); })
        //.attr('fill', 'steelblue')
        .attr('stroke', 'none');

    svg.append('g')
        .selectAll('.eventlink')
        .data(links)
      .enter().append('path')
        .attr('class', 'eventlink')
        .attr('d', function(d) {
          var curvature = .5;
          var x0 = d.srcX,
              x1 = d.dstX,
              y0 = d.srcY,
              y1 = d.dstY,
              yi = d3.interpolateNumber(y0, y1),
              y2 = yi(curvature),
              y3 = yi(1 - curvature);
          return "M" + x0 + "," + y0
               + "C" + x0 + "," + y2
               + " " + x1 + "," + y3
               + " " + x1 + "," + y1;
        })
        .style('stroke-width', function(d) { return d.value/10; });
  });
 
// Set the sankey diagram properties
/*var sankey = d3.sankey()
    .nodeWidth(10)
    .nodePadding(10)
    .marginLeft(1060)
    .size([width, height]);
 
var path = sankey.link();

var eventMyPath=null;*/
 
// load the data

</script>

</body></html>
